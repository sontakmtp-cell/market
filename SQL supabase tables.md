-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.applications (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone,
  jobId bigint,
  user_id uuid,
  fullName text,
  email text,
  phone text,
  address text,
  linkedin text,
  github text,
  portfolio text,
  summary text,
  technicalSkills jsonb,
  certifications ARRAY,
  experienceLevel text,
  cv jsonb,
  coverLetter text,
  portfolioFile jsonb,
  certificates ARRAY,
  customAnswers jsonb,
  applicationDate timestamp with time zone DEFAULT now(),
  status text DEFAULT 'submitted'::text,
  CONSTRAINT applications_pkey PRIMARY KEY (id),
  CONSTRAINT applications_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT applications_jobId_fkey FOREIGN KEY (jobId) REFERENCES public.recruitment_jobs(id)
);
CREATE TABLE public.contracts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id bigint NOT NULL,
  proposal_id uuid NOT NULL,
  client_id uuid NOT NULL,
  freelancer_id uuid NOT NULL,
  status text NOT NULL DEFAULT 'active'::text,
  start_date timestamp with time zone NOT NULL DEFAULT now(),
  deadline timestamp with time zone,
  budget_amount numeric NOT NULL,
  currency text DEFAULT 'VND'::text,
  progress integer DEFAULT 0,
  milestones jsonb,
  deliverables jsonb,
  payment_terms jsonb,
  contract_terms text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT contracts_pkey PRIMARY KEY (id),
  CONSTRAINT contracts_freelancer_id_fkey FOREIGN KEY (freelancer_id) REFERENCES auth.users(id),
  CONSTRAINT contracts_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.marketplace_projects(id),
  CONSTRAINT contracts_proposal_id_fkey FOREIGN KEY (proposal_id) REFERENCES public.proposals(id),
  CONSTRAINT contracts_client_id_fkey FOREIGN KEY (client_id) REFERENCES auth.users(id)
);
CREATE TABLE public.conversations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id bigint NOT NULL,
  client_id uuid NOT NULL,
  freelancer_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  last_message_preview text,
  unread_by_client boolean NOT NULL DEFAULT false,
  unread_by_freelancer boolean NOT NULL DEFAULT false,
  CONSTRAINT conversations_pkey PRIMARY KEY (id),
  CONSTRAINT conversations_client_id_fkey FOREIGN KEY (client_id) REFERENCES auth.users(id),
  CONSTRAINT conversations_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.marketplace_projects(id),
  CONSTRAINT conversations_freelancer_id_fkey FOREIGN KEY (freelancer_id) REFERENCES auth.users(id)
);
CREATE TABLE public.jobs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text NOT NULL,
  description text,
  company text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT jobs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.marketplace_projects (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone,
  client_user_id uuid,
  title text NOT NULL,
  shortDescription text,
  fullDescription text,
  category text,
  skills ARRAY,
  budgetMin bigint,
  budgetMax bigint,
  currency text DEFAULT 'VND'::text,
  duration text,
  deadline timestamp with time zone,
  isUrgent boolean DEFAULT false,
  location text,
  attachments ARRAY,
  objectives ARRAY,
  technicalRequirements ARRAY,
  deliverables ARRAY,
  client jsonb,
  proposalCount integer DEFAULT 0,
  status text DEFAULT 'active'::text,
  freelancer_id uuid,
  displayType text DEFAULT 'standard'::text CHECK ("displayType" = ANY (ARRAY['standard'::text, 'vip'::text])),
  vipFeePaid numeric DEFAULT 0,
  vipActivatedAt timestamp with time zone,
  vipExpiresAt timestamp with time zone,
  vipPaymentReference text,
  vipPaymentStatus text DEFAULT 'pending'::text CHECK ("vipPaymentStatus" = ANY (ARRAY['pending'::text, 'paid'::text, 'failed'::text, 'refunded'::text])),
  CONSTRAINT marketplace_projects_pkey PRIMARY KEY (id),
  CONSTRAINT marketplace_projects_client_user_id_fkey FOREIGN KEY (client_user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  conversation_id uuid NOT NULL,
  sender_id uuid NOT NULL,
  receiver_id uuid NOT NULL,
  content text NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  is_read boolean NOT NULL DEFAULT false,
  attachments jsonb,
  CONSTRAINT messages_pkey PRIMARY KEY (id),
  CONSTRAINT messages_receiver_id_fkey FOREIGN KEY (receiver_id) REFERENCES auth.users(id),
  CONSTRAINT messages_conversation_id_fkey FOREIGN KEY (conversation_id) REFERENCES public.conversations(id),
  CONSTRAINT messages_sender_id_fkey FOREIGN KEY (sender_id) REFERENCES auth.users(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  updated_at timestamp with time zone,
  username text UNIQUE,
  display_name text,
  avatar_url text,
  cover_image_url text,
  bio text,
  location text,
  languages ARRAY,
  phone text,
  social_links jsonb,
  visibility jsonb,
  role_profiles jsonb,
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);
CREATE TABLE public.projects (
  id text NOT NULL,
  title text NOT NULL,
  client_id uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  freelancer_id uuid,
  status text NOT NULL DEFAULT 'open'::text,
  short_description text,
  budget_min numeric,
  budget_max numeric,
  currency text DEFAULT 'VND'::text,
  deadline date,
  CONSTRAINT projects_pkey PRIMARY KEY (id),
  CONSTRAINT projects_client_id_fkey FOREIGN KEY (client_id) REFERENCES auth.users(id),
  CONSTRAINT projects_freelancer_id_fkey FOREIGN KEY (freelancer_id) REFERENCES auth.users(id)
);
CREATE TABLE public.proposals (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  freelancer_id uuid,
  bid_amount numeric NOT NULL,
  timeline text,
  cover_letter text,
  status text NOT NULL DEFAULT 'submitted'::text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  project_id bigint NOT NULL,
  CONSTRAINT proposals_pkey PRIMARY KEY (id),
  CONSTRAINT proposals_freelancer_id_fkey FOREIGN KEY (freelancer_id) REFERENCES auth.users(id),
  CONSTRAINT fk_proposals_project_id FOREIGN KEY (project_id) REFERENCES public.marketplace_projects(id)
);
CREATE TABLE public.recruitment_jobs (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone,
  user_id uuid,
  title text,
  department text,
  location text,
  locationType text,
  employmentType text,
  experienceLevel text,
  description text,
  responsibilities text,
  requirements text,
  skills ARRAY,
  certifications ARRAY,
  salaryMin bigint,
  salaryMax bigint,
  currency text DEFAULT 'VND'::text,
  showSalary boolean DEFAULT false,
  benefits ARRAY,
  contractTerms text,
  applicationDeadline timestamp with time zone,
  screeningQuestions jsonb,
  autoResponse boolean DEFAULT false,
  responseTemplate text,
  attachments ARRAY,
  companyMaterials ARRAY,
  status text DEFAULT 'active'::text,
  templateType text,
  CONSTRAINT recruitment_jobs_pkey PRIMARY KEY (id),
  CONSTRAINT recruitment_jobs_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.saved_jobs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  job_id bigint NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT saved_jobs_pkey PRIMARY KEY (id),
  CONSTRAINT saved_jobs_job_id_fkey FOREIGN KEY (job_id) REFERENCES public.marketplace_projects(id),
  CONSTRAINT saved_jobs_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);